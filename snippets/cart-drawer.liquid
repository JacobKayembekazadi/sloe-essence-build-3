{% comment %}
  Cart drawer component for Shopify 2.0
{% endcomment %}

<cart-drawer class="drawer drawer--cart">
  <div class="drawer__inner">
    <div class="drawer__header">
      <h2 class="drawer__heading">{{ 'sections.cart.title' | t }}</h2>
      <button
        class="drawer__close"
        type="button"
        onclick="this.closest('cart-drawer').close()"
        aria-label="{{ 'accessibility.close' | t }}"
      >
        {% render 'icon', icon: 'close' %}
      </button>
    </div>
    
    <cart-drawer-items class="drawer__contents">
      {%- if cart == empty -%}
        <div class="cart--no-items">
          <p class="cart__empty-text">{{ 'sections.cart.empty' | t }}</p>
        </div>
      {%- else -%}
        <form action="{{ routes.cart_url }}" class="cart__contents" method="post" id="cart">
          <div class="cart__items" id="main-cart-items" data-id="{{ section.id }}">
            <div class="js-contents">
              {%- for item in cart.items -%}
                <div class="cart-item" id="CartItem-{{ item.index | plus: 1 }}">
                  <div class="cart-item__media">
                    {%- if item.image -%}
                      <img class="cart-item__image"
                        src="{{ item.image | image_url: width: 100 }}"
                        alt="{{ item.image.alt | escape }}"
                        width="100"
                        height="{{ 100 | divided_by: item.image.aspect_ratio | ceil }}"
                        loading="lazy"
                      >
                    {%- endif -%}
                  </div>

                  <div class="cart-item__details">
                    <a href="{{ item.url }}" class="cart-item__name h4 break">{{ item.product.title | escape }}</a>

                    {%- if item.product.has_only_default_variant == false or item.properties.size != 0 or item.selling_plan_allocation != nil -%}
                      <dl class="cart-item__discounts">
                        {%- unless item.product.has_only_default_variant -%}
                          {%- for option in item.options_with_values -%}
                            <div class="product-option">
                              <dt>{{ option.name }}: </dt>
                              <dd>{{ option.value }}</dd>
                            </div>
                          {%- endfor -%}
                        {%- endunless -%}
                      </dl>
                    {%- endif -%}

                    <div class="cart-item__quantity">
                      <quantity-input class="quantity">
                        <button class="quantity__button no-js-hidden" name="minus" type="button">
                          <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: item.product.title | escape }}</span>
                          <svg aria-hidden="true" focusable="false" viewBox="0 0 10 2">
                            <path d="M10 0v2H0V0z" fill="currentColor">
                          </svg>
                        </button>
                        <input class="quantity__input"
                          type="number"
                          name="updates[]"
                          value="{{ item.quantity }}"
                          min="0"
                          aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                          id="Quantity-{{ item.index | plus: 1 }}"
                          data-index="{{ item.index | plus: 1 }}"
                        >
                        <button class="quantity__button no-js-hidden" name="plus" type="button">
                          <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: item.product.title | escape }}</span>
                          <svg aria-hidden="true" focusable="false" viewBox="0 0 10 10">
                            <path d="M6 4V0H4v4H0v2h4v4h2V6h4V4H6z" fill="currentColor" fill-rule="evenodd">
                          </svg>
                        </button>
                      </quantity-input>

                      <cart-remove-button id="Remove-{{ item.index | plus: 1 }}" data-index="{{ item.index | plus: 1 }}">
                        <a href="{{ item.url_to_remove }}" class="button button--tertiary" aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                            <path d="M14 3h-3.53a3.07 3.07 0 00-.6-1.65C9.44.82 8.8.5 8 .5s-1.44.32-1.87.85A3.06 3.06 0 005.53 3H2a.5.5 0 000 1h1.25v10c0 .28.22.5.5.5h8.5a.5.5 0 00.5-.5V4H14a.5.5 0 000-1zM6.91 1.98c.23-.29.58-.48 1.09-.48s.85.19 1.09.48c.2.24.3.6.36 1.02h-2.9c.05-.42.17-.78.36-1.02zm4.84 11.52h-7.5V4h7.5v9.5z" fill="currentColor"/>
                            <path d="M6.55 5.25a.5.5 0 00-.5.5v6a.5.5 0 001 0v-6a.5.5 0 00-.5-.5zm2.9 0a.5.5 0 00-.5.5v6a.5.5 0 001 0v-6a.5.5 0 00-.5-.5z" fill="currentColor"/>
                          </svg>
                        </a>
                      </cart-remove-button>
                    </div>

                    <div class="cart-item__price">
                      {%- if item.original_price != item.final_price -%}
                        <dl class="cart-item__discounted-prices">
                          <dt class="visually-hidden">
                            {{ 'products.product.price.regular_price' | t }}
                          </dt>
                          <dd>
                            <s class="cart-item__old-price product-option">
                              {{ item.original_price | money }}
                            </s>
                          </dd>
                          <dt class="visually-hidden">
                            {{ 'products.product.price.sale_price' | t }}
                          </dt>
                          <dd class="price price--end">
                            {{ item.final_price | money }}
                          </dd>
                        </dl>
                      {%- else -%}
                        <span class="price price--end">
                          {{ item.original_price | money }}
                        </span>
                      {%- endif -%}

                      {%- if item.variant.available and item.unit_price_measurement -%}
                        <div class="unit-price caption">
                          <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                          {{ item.variant.unit_price | money }}
                          <span aria-hidden="true">/</span>
                          <span class="visually-hidden">&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span>
                          {%- if item.variant.unit_price_measurement.reference_value != 1 -%}
                            {{- item.variant.unit_price_measurement.reference_value -}}
                          {%- endif -%}
                          {{ item.variant.unit_price_measurement.reference_unit }}
                        </div>
                      {%- endif -%}
                    </div>
                  </div>
                </div>
              {%- endfor -%}
            </div>
          </div>

          <div class="cart__footer">
            <div class="cart__subtotal">
              <div class="cart__blocks">
                <div class="cart-note">
                  <label for="Cart-note" class="cart-note__label caption-with-letter-spacing">{{ 'sections.cart.note' | t }}</label>
                  <textarea id="Cart-note" class="text-area text-area--resize-vertical" name="note" placeholder="{{ 'sections.cart.note' | t }}">{{ cart.note }}</textarea>
                </div>
              </div>
              
              <div class="totals">
                <h3 class="totals__subtotal">{{ 'sections.cart.subtotal' | t }}</h3>
                <p class="totals__subtotal-value">{{ cart.total_price | money_with_currency }}</p>
              </div>

              <small class="tax-note caption-large">
                {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
                  {{ 'sections.cart.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
                {%- elsif cart.taxes_included -%}
                  {{ 'sections.cart.taxes_included_but_shipping_at_checkout' | t }}
                {%- elsif shop.shipping_policy.body != blank -%}
                  {{ 'sections.cart.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
                {%- else -%}
                  {{ 'sections.cart.taxes_and_shipping_at_checkout' | t }}
                {%- endif -%}
              </small>
            </div>
            
            <div class="cart__ctas" {{ block.shopify_attributes }}>
              <noscript>
                <button type="submit" class="cart__update-button btn-outline button--full-width" form="cart">
                  {{ 'sections.cart.update' | t }}
                </button>
              </noscript>

              <button type="submit" id="checkout" class="cart__checkout-button button button--full-width" name="add" form="cart">
                {{ 'sections.cart.checkout' | t }}
              </button>
            </div>
          </div>
        </form>
      {%- endif -%}
    </cart-drawer-items>
  </div>
</cart-drawer>

<style>
  .drawer {
    position: fixed;
    top: 0;
    right: -100%;
    width: 420px;
    height: 100vh;
    background: white;
    z-index: 1000;
    transition: right 0.3s ease;
    box-shadow: -2px 0 10px rgba(0,0,0,0.1);
  }

  .drawer.is-open {
    right: 0;
  }

  .drawer__inner {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .drawer__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid var(--color-border);
  }

  .drawer__contents {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
  }

  .cart-item {
    display: flex;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid var(--color-border);
  }

  .cart-item__media {
    flex-shrink: 0;
  }

  .cart-item__image {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
  }

  .cart-item__details {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .cart__footer {
    padding: 1rem;
    border-top: 1px solid var(--color-border);
  }

  .cart__checkout-button {
    width: 100%;
    background-color: var(--color-primary);
    color: white;
    padding: 1rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
  }

  @media (max-width: 480px) {
    .drawer {
      width: 100%;
      right: -100%;
    }
  }
</style>